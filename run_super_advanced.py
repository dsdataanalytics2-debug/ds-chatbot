#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ЁЯЪА рж╕рзБржкрж╛рж░ ржЙржирзНржиржд AI ржорзЗржбрж┐рж╕рж┐ржи ржЪрзНржпрж╛ржЯржмржЯ рж░рж╛ржи рж╕рзНржХрзНрж░рж┐ржкрзНржЯ
ChatGPT/Cursor AI рж╕рзНржЯрж╛ржЗрж▓рзЗ рж╕рж░рзНржмрзЛржЪрзНржЪ ржорж╛ржирзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржЙрждрзНрждрж░ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗ
"""

import os
import sys
import subprocess
import platform
import time
from pathlib import Path

def print_banner():
    """ржкрзНрж░рж┐ржирзНржЯ рж╕рзБржирзНржжрж░ ржмрзНржпрж╛ржирж╛рж░"""
    print("=" * 80)
    print("ЁЯЪА рж╕рзБржкрж╛рж░ ржЙржирзНржиржд AI ржорзЗржбрж┐рж╕рж┐ржи ржЪрзНржпрж╛ржЯржмржЯ")
    print("ChatGPT/Cursor AI рж╕рзНржЯрж╛ржЗрж▓рзЗ рж╕рж░рзНржмрзЛржЪрзНржЪ ржорж╛ржирзЗрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржЙрждрзНрждрж░ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗ")
    print("=" * 80)
    print()

def print_features():
    """ржкрзНрж░рж┐ржирзНржЯ ржмрзИрж╢рж┐рж╖рзНржЯрзНржпрж╕ржорзВрж╣"""
    print("тЬи **рж╕рзБржкрж╛рж░ ржЙржирзНржиржд ржмрзИрж╢рж┐рж╖рзНржЯрзНржпрж╕ржорзВрж╣:**")
    print("ЁЯФН рж╕рзНржорж╛рж░рзНржЯ ржЕржирзБрж╕ржирзНржзрж╛ржи - ржорзЗржбрж┐рж╕рж┐ржирзЗрж░ ржирж╛ржо, ржЬрзЗржирзЗрж░рж┐ржХ ржирж╛ржо, ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржХрж╛рж░ржг ржЕржирзБрж╕ржирзНржзрж╛ржи")
    print("ЁЯУЛ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд рждржерзНржп - рж╕ржорзНржкрзВрж░рзНржг ржорзЗржбрж┐рж╕рж┐ржи рждржерзНржп рж╕рзБржирзНржжрж░ржнрж╛ржмрзЗ ржкрзНрж░ржжрж░рзНрж╢ржи")
    print("ЁЯТб рж╕рж╣рж╛ржпрж╝ржХ ржкрж░рж╛ржорж░рзНрж╢ - рж╕рзНржмрж╛рж╕рзНржерзНржп рж╕ржорзНржкрж░рзНржХрж┐ржд рж╕рж╛ржзрж╛рж░ржг ржкрж░рж╛ржорж░рзНрж╢")
    print("ЁЯОи рж╕рзБржирзНржжрж░ UI - ржЖржзрзБржирж┐ржХ ржПржмржВ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА-ржмрж╛ржирзНржзржм ржЗржирзНржЯрж╛рж░ржлрзЗрж╕")
    print("ЁЯУК ржкрж░рж┐рж╕ржВржЦрзНржпрж╛ржи - ржЪрзНржпрж╛ржЯ ржЗрждрж┐рж╣рж╛рж╕ ржПржмржВ ржмрзНржпржмрж╣рж╛рж░ ржкрж░рж┐рж╕ржВржЦрзНржпрж╛ржи")
    print("ЁЯФД ржЪрзНржпрж╛ржЯ ржЗрждрж┐рж╣рж╛рж╕ - ржкрзВрж░рзНржмржмрж░рзНрждрзА ржХржерзЛржкржХржержи рж╕рзНржорж░ржг рж░рж╛ржЦрж╛")
    print("ЁЯЪА рж╕рж░рзНржмрзЛржЪрзНржЪ ржорж╛ржирзЗрж░ ржЙрждрзНрждрж░ - ChatGPT/Cursor AI рж╕рзНржЯрж╛ржЗрж▓")
    print("тП░ рж╕ржоржпрж╝ рж╕рзНржЯрзНржпрж╛ржорзНржк - ржкрзНрж░рждрж┐ржЯрж┐ ржЙрждрзНрждрж░рзЗ рж╕ржоржпрж╝ ржкрзНрж░ржжрж░рзНрж╢ржи")
    print("ЁЯФе ржЬржиржкрзНрж░рж┐ржпрж╝ ржЕржирзБрж╕ржирзНржзрж╛ржи - рж╕ржмржЪрзЗржпрж╝рзЗ ржмрзЗрж╢рж┐ ржЕржирзБрж╕ржирзНржзрж╛ржиржХрзГржд ржмрж┐рж╖ржпрж╝")
    print()

def check_python():
    """Python ржнрж╛рж░рзНрж╕ржи ржЪрзЗржХ ржХрж░рзБржи"""
    print("ЁЯРН Python ржнрж╛рж░рзНрж╕ржи ржЪрзЗржХ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...")
    try:
        version = sys.version_info
        print(f"тЬЕ Python {version.major}.{version.minor}.{version.micro} ржкрж╛ржУржпрж╝рж╛ ржЧрзЗржЫрзЗ")
        if version.major < 3 or (version.major == 3 and version.minor < 7):
            print("тЭМ Python 3.7+ ржкрзНрж░ржпрж╝рзЛржЬржи!")
            return False
        return True
    except Exception as e:
        print(f"тЭМ Python ржЪрзЗржХ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛: {e}")
        return False

def install_requirements():
    """ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи"""
    print("\nЁЯУж ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...")
    
    # Check if requirements file exists
    requirements_file = "requirements_advanced_ai.txt"
    if not Path(requirements_file).exists():
        print(f"тЭМ {requirements_file} ржлрж╛ржЗрж▓ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐!")
        print("ЁЯТб ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ requirements_advanced_ai.txt ржлрж╛ржЗрж▓ржЯрж┐ ржкрзНрж░ржЬрзЗржХрзНржЯ ржлрзЛрж▓рзНржбрж╛рж░рзЗ рж░рж╛ржЦрзБржи")
        return False
    
    try:
        # Use appropriate pip command for the platform
        if platform.system() == "Windows":
            cmd = ["py", "-m", "pip", "install", "-r", requirements_file]
        else:
            cmd = [sys.executable, "-m", "pip", "install", "-r", requirements_file]
        
        print("ЁЯФД ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ рж╣ржЪрзНржЫрзЗ... (ржПржЯрж┐ ржХрж┐ржЫрзБ рж╕ржоржпрж╝ ржирж┐рждрзЗ ржкрж╛рж░рзЗ)")
        result = subprocess.run(cmd, capture_output=True, text=True)
        
        if result.returncode == 0:
            print("тЬЕ рж╕ржм ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ рж╣ржпрж╝рзЗржЫрзЗ")
            return True
        else:
            print(f"тЭМ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛:")
            print(result.stderr)
            return False
            
    except Exception as e:
        print(f"тЭМ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛: {e}")
        return False

def check_excel_file():
    """Excel ржлрж╛ржЗрж▓ ржЪрзЗржХ ржХрж░рзБржи"""
    print("\nЁЯУК Excel ржлрж╛ржЗрж▓ ржЪрзЗржХ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...")
    
    excel_file = Path("medicine_data.xlsx")
    if excel_file.exists():
        print(f"тЬЕ {excel_file} ржкрж╛ржУржпрж╝рж╛ ржЧрзЗржЫрзЗ")
        
        # Check file size
        file_size = excel_file.stat().st_size
        if file_size > 0:
            print(f"ЁЯУП ржлрж╛ржЗрж▓ рж╕рж╛ржЗржЬ: {file_size / 1024:.1f} KB")
            return True
        else:
            print("тЭМ ржлрж╛ржЗрж▓ржЯрж┐ ржЦрж╛рж▓рж┐!")
            return False
    else:
        print(f"тЭМ {excel_file} ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐!")
        print("ЁЯТб ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖржкржирж╛рж░ Excel ржлрж╛ржЗрж▓ржЯрж┐ ржкрзНрж░ржЬрзЗржХрзНржЯ ржлрзЛрж▓рзНржбрж╛рж░рзЗ рж░рж╛ржЦрзБржи")
        return False

def check_chatbot_file():
    """ржЪрзНржпрж╛ржЯржмржЯ ржлрж╛ржЗрж▓ ржЪрзЗржХ ржХрж░рзБржи"""
    print("\nЁЯдЦ ржЪрзНржпрж╛ржЯржмржЯ ржлрж╛ржЗрж▓ ржЪрзЗржХ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...")
    
    chatbot_file = Path("super_advanced_ai_chatbot.py")
    if chatbot_file.exists():
        print(f"тЬЕ {chatbot_file} ржкрж╛ржУржпрж╝рж╛ ржЧрзЗржЫрзЗ")
        return True
    else:
        print(f"тЭМ {chatbot_file} ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐!")
        return False

def run_chatbot():
    """ржЪрзНржпрж╛ржЯржмржЯ ржЪрж╛рж▓рзБ ржХрж░рзБржи"""
    print("\nЁЯЪА рж╕рзБржкрж╛рж░ ржЙржирзНржиржд AI ржЪрзНржпрж╛ржЯржмржЯ ржЪрж╛рж▓рзБ рж╣ржЪрзНржЫрзЗ...")
    print("ЁЯМР ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ http://localhost:8501 ржП ржпрж╛ржи")
    print("ЁЯЫС ржмржирзНржз ржХрж░рждрзЗ Ctrl+C ржЪрж╛ржкрзБржи")
    print("ЁЯУ▒ ржорзЛржмрж╛ржЗрж▓ ржерзЗржХрзЗ http://[ржЖржкржирж╛рж░-IP]:8501 ржП ржпрзЗрждрзЗ ржкрж╛рж░рзЗржи")
    print("ЁЯОи рж╕рзБржирзНржжрж░ UI ржПржмржВ рж╕рж░рзНржмрзЛржЪрзНржЪ ржорж╛ржирзЗрж░ ржЙрждрзНрждрж░ ржЙржкржнрзЛржЧ ржХрж░рзБржи")
    print("-" * 80)
    
    try:
        # Use appropriate streamlit command for the platform
        if platform.system() == "Windows":
            cmd = ["py", "-m", "streamlit", "run", "super_advanced_ai_chatbot.py", "--server.port", "8501"]
        else:
            cmd = [sys.executable, "-m", "streamlit", "run", "super_advanced_ai_chatbot.py", "--server.port", "8501"]
        
        print("ЁЯФД ржЪрзНржпрж╛ржЯржмржЯ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...")
        subprocess.run(cmd)
        
    except KeyboardInterrupt:
        print("\nЁЯСЛ ржЪрзНржпрж╛ржЯржмржЯ ржмржирзНржз ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ")
    except subprocess.CalledProcessError as e:
        print(f"тЭМ ржЪрзНржпрж╛ржЯржмржЯ ржЪрж╛рж▓рзБ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛: {e}")
    except FileNotFoundError:
        print("тЭМ Streamlit ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐! ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи: pip install streamlit")

def show_usage_tips():
    """ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржЯрж┐ржкрж╕ ржжрзЗржЦрж╛ржи"""
    print("\nЁЯТб **ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржЯрж┐ржкрж╕:**")
    print("ЁЯФ╕ ржорзЗржбрж┐рж╕рж┐ржирзЗрж░ ржирж╛ржо рж▓рж┐ржЦрзБржи (ржпрзЗржоржи: Paracetamol, Aspirin)")
    print("ЁЯФ╕ ржЬрзЗржирзЗрж░рж┐ржХ ржирж╛ржо ржжрж┐ржпрж╝рзЗ ржЕржирзБрж╕ржирзНржзрж╛ржи ржХрж░рзБржи")
    print("ЁЯФ╕ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржХрж╛рж░ржг рж▓рж┐ржЦрзБржи (ржпрзЗржоржи: ржЬрзНржмрж░, ржмрзНржпржерж╛)")
    print("ЁЯФ╕ рж╕рж╛ржзрж╛рж░ржг рж╕рзНржмрж╛рж╕рзНржерзНржп ржкрж░рж╛ржорж░рзНрж╢ ржЪрж╛ржЗрждрзЗ ржкрж╛рж░рзЗржи")
    print("ЁЯФ╕ ржЙржжрж╛рж╣рж░ржг ржкрзНрж░рж╢рзНржи ржмрзЛрждрж╛ржо ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи")
    print("ЁЯФ╕ рж╕рж░рзНржмрзЛржЪрзНржЪ ржорж╛ржирзЗрж░ ржЙрждрзНрждрж░ ржЙржкржнрзЛржЧ ржХрж░рзБржи")
    print()

def show_demo_queries():
    """ржбрзЗржорзЛ ржкрзНрж░рж╢рзНржи ржжрзЗржЦрж╛ржи"""
    print("\nЁЯОп **ржбрзЗржорзЛ ржкрзНрж░рж╢рзНржирж╕ржорзВрж╣:**")
    print("ЁЯТК **ржорзЗржбрж┐рж╕рж┐ржи ржЕржирзБрж╕ржирзНржзрж╛ржи:**")
    print("   тАв Paracetamol рж╕ржорзНржкрж░рзНржХрзЗ ржЬрж╛ржирждрзЗ ржЪрж╛ржЗ")
    print("   тАв Aspirin ржПрж░ ржкрж╛рж░рзНрж╢рзНржм ржкрзНрж░рждрж┐ржХрзНрж░рж┐ржпрж╝рж╛ ржХрзА?")
    print("   тАв ржЬрзНржмрж░рзЗрж░ ржЬржирзНржп ржХрзЛржи ржорзЗржбрж┐рж╕рж┐ржи ржнрж╛рж▓рзЛ?")
    print()
    print("ЁЯПе **рж╕рзНржмрж╛рж╕рзНржерзНржп ржкрж░рж╛ржорж░рзНрж╢:**")
    print("   тАв рж╕рзБрж╕рзНрже ржерж╛ржХрж╛рж░ ржЬржирзНржп ржкрж░рж╛ржорж░рзНрж╢ ржжрж┐ржи")
    print("   тАв ржирж┐ржпрж╝ржорж┐ржд ржмрзНржпрж╛ржпрж╝рж╛ржорзЗрж░ ржЙржкржХрж╛рж░рж┐рждрж╛")
    print("   тАв ржорж╛ржирж╕рж┐ржХ рж╕рзНржмрж╛рж╕рзНржерзНржп ржнрж╛рж▓рзЛ рж░рж╛ржЦрж╛рж░ ржЙржкрж╛ржпрж╝")
    print()

def main():
    """ржорзЗржЗржи ржлрж╛ржВрж╢ржи"""
    print_banner()
    print_features()
    
    # Check Python
    if not check_python():
        input("\nEnter ржЪрж╛ржкрзБржи ржмржирзНржз ржХрж░рждрзЗ...")
        return
    
    # Check chatbot file
    if not check_chatbot_file():
        print("тЭМ ржЪрзНржпрж╛ржЯржмржЯ ржлрж╛ржЗрж▓ ржЫрж╛ржбрж╝рж╛ ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛ржмрзЗ ржирж╛")
        input("\nEnter ржЪрж╛ржкрзБржи ржмржирзНржз ржХрж░рждрзЗ...")
        return
    
    # Install requirements
    if not install_requirements():
        print("тЭМ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрзНржпрж╛ржХрзЗржЬ ржЗржирж╕рзНржЯрж▓ ржирж╛ рж╣рж▓рзЗ ржЪрзНржпрж╛ржЯржмржЯ ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛ржмрзЗ ржирж╛")
        input("\nEnter ржЪрж╛ржкрзБржи ржмржирзНржз ржХрж░рждрзЗ...")
        return
    
    # Check Excel file
    if not check_excel_file():
        print("тЭМ Excel ржлрж╛ржЗрж▓ ржЫрж╛ржбрж╝рж╛ ржЪрзНржпрж╛ржЯржмржЯ ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛ржмрзЗ ржирж╛")
        input("\nEnter ржЪрж╛ржкрзБржи ржмржирзНржз ржХрж░рждрзЗ...")
        return
    
    # Show usage tips and demo queries
    show_usage_tips()
    show_demo_queries()
    
    # Run chatbot
    run_chatbot()

if __name__ == "__main__":
    main()
